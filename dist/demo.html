<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="../src/core/afterburner.js"></script>
<script src="../src/core/store.js"></script>
<script src="../src/core/aSchema.js"></script>
<script src="../src/core/aTable.js"></script>
<script src="../src/core/queryResult.js"></script>
<script src="../src/core/hashIndex.js"></script>
<script src="../src/core/dataSource.js"></script>
<script src="../src/core/common.js"></script>
<script src="../src/core/html5FileParser.js"></script>
<script src="../src/frontend/myJS.js"></script>
<!--<script src="../src/proxy/proxyClient.js"></script>-->
<!-- <script src="./browser-frontend.min.js"></script> -->
<script>
function myOnLoad(){
  ABi = new Afterburner();
  document.getElementById("TAASM").value="";
}

window.onload = function() {
  inNode=false;
  var fileInput = document.getElementById('fileInput');
  fileInput.addEventListener('change', function(e) {
    var file = fileInput.files[0];
    var ds= new dataSource(file, function(){newTable= new aTable(ds);});
    //;
  });
  myOnLoad();
}
function runASM(){
  asmcode=document.getElementById("TAASM").value;
  document.getElementById("console").innerHTML = "ASM=" + asmcode
  tt0=window.performance.now();
//        for(zz=0;zz<100;zz++)
  runMyAdhocCode(asmcode);
  tt1=window.performance.now();
  console.log('time to run asm:'+ (tt1-tt0));
}

function resetFluentASMq1(){
  document.getElementById("TAFluent").value=`ABi.select()
  .from("orders")
  .field(count("o_totalprice"))
  .where(lt("o_totalprice",1500))
  .toString()`;
  fluentToASM();
}
function resetFluentASMq2(){
  document.getElementById("TAFluent").value=`ABi.select()
  .from("lineitem").join("orders").on("l_orderkey","o_orderkey")
  .field(sum('o_totalprice'))
  .toString()`;
  fluentToASM();
}
function resetFluentASMq3(){
  document.getElementById("TAFluent").value=`ABi.select()
  .field("o_orderdate")
  .field(count('o_orderkey'))
  .from("orders")
  .group("o_orderdate")
  .toString()`;
  fluentToASM();
}
function resetFluentASMq4(){
  document.getElementById("TAFluent").value=`ABi.select()
  .from("lineitem").join("orders").on("l_orderkey","o_orderkey")
  .field("l_orderkey")
  .field(sum('l_extendedprice'))
  .field("o_orderdate")
  .field("o_shippriority")
  .where(between('o_orderdate', date('1996-01-01'), date('1996-01-31')))
  .group("l_orderkey")
  .group("o_orderdate")
  .group("o_shippriority")
  .order([-1])
  .limit(10)
  .toString()`;
  fluentToASM();
}
/*ABi.select().from("myview").field("l_orderkey").field("revenue").field("o_orderdate").field("o_shippriority").where(eq('o_orderdate',date('1996-01-06'))).order([-1]).limit(10).toString()*/
function fluentToASM(){
        strASM="document.getElementById(\"TAASM\").value="
        strASM= strASM + document.getElementById("TAFluent").value;

	document.getElementById("console").innerHTML = strASM;

	try {
		runMyAdhocCode(strASM);
	}
	catch(err) {
	    document.getElementById("console").innerHTML = err.message;
	}
}
</script>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
  <script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  <style type="text/css">
    .modal {
      text-align: left;
    }
    pre.prettyprint {
      border: 1px solid #ccc;
      margin-bottom: 0;
      padding: 9.5px;
    }
  </style>




    <title>Afterburner Demo</title>

    <!-- Bootstrap core CSS -->
<!--   <link href="../../dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<!--    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet"> -->
    <!-- Custom styles for this template -->
<!--    <link href="jumbotron.css" rel="stylesheet">  -->
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<!--    <script src="../../assets/js/ie-emulation-modes-warning.js"></script> -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Afterburner</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="./index.html">Home</a></li>
            <li class="active"><a href="./demo.html">Demo</a></li>
            <li><a href="https://github.com/lintool/afterburner/">Code (GitHub)</a></li>
          </ul>

        </div><!--/.navbar-collapse -->
      </div>
    </nav>

    <!-- Main jumbotron for a primary marketing message or call to action -->

<!--<div>
      <a>Load a table from a file server.</a><br>
     Server: <input type="text" name="fserverIP" value="127.0.0.1"><br>
     Port: <input type="text" name="fserverPort" value="55443"><br>
     <button submit="submit" id="loadserver">get table from server</button><hr>
</div>-->

   <div class="jumbotron">
    <div class="container">
       <div class="row">
         <div class="col-md-6">
            <a>Load a table from local file.</a><br>
            <label class="btn btn-default btn-file">Browse <input type="file"  id="fileInput"> </label>
          </div>
      </div>

      <div class="row">
        <div class="col-md-2">
          <button type="button" onclick="document.getElementById("TableControl").innerHTML = daSchema.toString(); " class="btn btn-default" href="#" >PrintSchema</button>
        </div>
        <div class="col-md-10">
          <p id="sconsole" class="row table-responsive"  >Schema:</p>
<!--      <div id="divcons" class="row table-responsive"> </div>-->
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <h2>Fluent SQL</h2>
		<textarea rows="7" id="TAFluent" name="TAFluent" class="prettyprint form-control animated" placeholder="Type Fluent SQL or use example buttons.."></textarea>
		<button type="button" onclick="fluentToASM()" class="btn btn-default" href="#" >Fluent to ASM</button><br>
		<button type="button" onclick="resetFluentASMq1()" class="btn btn-default" href="#" >Q1 Fluent</button>
		<button type="button" onclick="resetFluentASMq2()" class="btn btn-default" href="#" >Q2 Fluent</button>
		<button type="button" onclick="resetFluentASMq3()" class="btn btn-default" href="#" >Q3 Fluent</button>
		<button type="button" onclick="resetFluentASMq4()" class="btn btn-default" href="#" >Q4 Fluent</button>
        </div>
        <div class="col-md-6">
          <h2>JavaScript Code</h2>
		<textarea rows="7" id="TAASM" name="TAASM" class="prettyprint form-control animated" placeholder="" ></textarea>
		<button type="button" onclick="runASM()" class="btn btn-default" href="#" >Run ASM</button>
       </div>
      </div>

      <div id="divcons" class="row table-responsive"> </div>

<!--<button type="button" onclick="runDemo()">Run Demo</button>-->
<!--<button type="button" onclick="runQuery()">Run Query</button>-->

<br> <hr> 
<div id="divconsole">
<p id="console">Console area!</p>
</div>


<textarea id="mytextareainv" style="display:none;">
</textarea>
<br> <hr> <br>    </div> <!-- /container -->

<div id="waitForFile" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <p>Loading.. Please wait..</p>
      </div>
    </div>

  </div>
</div>

  </body>
</html>

